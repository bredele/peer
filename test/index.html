<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Peer connection</title>
</head>
<body>
	<video id="master" autoplay muted></video>
  <video id="slave" autoplay muted></video>
  <video id="test" autoplay muted></video>
	<script src="../build/build.js"></script>
	<script>
	  var peer = require('peer');

	  // master
	  var master = peer(null);
	  var slave = peer(null);

		master.use(connect(slave));

	  function connect(other, node) {

			return function(ctx) {

				ctx.on('candidate', function(candidate) {
					console.log('candidate generate by master');
					other.ice(candidate);
					console.log('candidate generate by master');
				});

				other.on('candidate', function(candidate) {
					console.log('candidate generate by slave');
					ctx.ice(candidate);
					console.log('candidate generate by master');
				});

				other.on('answer', function(offer) {
					console.log('master get answer');
					ctx.remote(offer);
					console.log('slave set remote sdp');
				});

				ctx.on('offer', function(offer) {
					console.log('master generated offer');
					other.remote(offer);
					console.log('slave set remote sdp');
					other.answer();
					console.log('slave generated answer');
				});

				other.on('remote stream', function(stream) {
					document.querySelector('#slave').src = window.URL.createObjectURL(stream);
				});

	// media.once('stream', function(data, stream, url) {
	// ctx.stream(stream);
	// });
				// ctx.on('local stream', function() {
				// 	ctx.offer();
				// });

			ctx.create();
			other.create();
			ctx.offer(function() {
				console.log(arguments);
			});
			};
		}

	</script>
</body>
</html>