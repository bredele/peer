<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Peer connection</title>
</head>
<body>
	<video id="master" autoplay muted></video>
  <video id="slave" autoplay muted></video>
  <video id="test" autoplay muted></video>
	<script src="../build/build.js"></script>
	<script>
	  var peer = require('peer');

	  // master
	  var master = peer(null, '#master');
	  var slave = peer(null);

		master.use(connect(slave));

	  function connect(other, node) {
			return function(ctx) {
				ctx.on('candidate', function(candidate) {
					other.ice(candidate);
				});

				other.on('candidate', function(candidate) {
					ctx.ice(candidate);
				});

				other.on('answer', function(offer) {
					ctx.remote(offer);
				});

				ctx.on('offer', function(offer) {
					other.remote(offer);
					other.answer();
				});

				other.on('remote stream', function(stream) {
					document.querySelector('#slave').src = window.URL.createObjectURL(stream);
					//attach(stream, node);
				});

				ctx.on('local stream', function() {
					ctx.offer();
				});
			};
		}

	</script>
</body>
</html>